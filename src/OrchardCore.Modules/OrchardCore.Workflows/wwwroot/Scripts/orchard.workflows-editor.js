/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path="../../../../../node_modules/@types/jquery/index.d.ts" />
var applyFilter = function (category, q) {
    var type = $('.modal-activities').data('activity-type');
    category = category || $('.activity-picker-categories .nav-link.active').attr('href').substr(1);
    q = q || $('.modal-activities input[type=search]').val();
    var $cards = $('.activity.card').show();
    // Remove activities whoes type doesn't match the configured activity type.
    $cards.filter(function (i, el) {
        return $(el).data('activity-type') != type;
    }).hide();
    if (q.length > 0) {
        // Remove activities whose title doesn't match the query.
        $cards.filter(function (i, el) {
            return $(el).find('.card-title').text().toLowerCase().indexOf(q.toLowerCase()) < 0 && q && q.length > 0;
        }).hide();
    }
    else {
        // Remove activities whose category doesn't match the selected one.
        $cards.filter(function (i, el) {
            return $(el).data('category').toLowerCase() != category.toLowerCase() && category.toLowerCase() != 'all';
        }).hide();
    }
    // Show or hide categories based on whether there are any available activities.
    $('.activity-picker-categories [data-category]').each(function (i, el) {
        var categoryListItem = $(el);
        var category = categoryListItem.data('category');
        // Count number of activities within this category and for the specified activity type (Event or Task).
        var activityCount = $(".activity.card[data-category='" + category + "'][data-activity-type='" + type + "']").length;
        activityCount == 0 ? categoryListItem.hide() : categoryListItem.show();
    });
};
$(function () {
    $('.activity-picker-categories').on('click', '.nav-link', function (e) {
        applyFilter($(e.target).attr('href').substr(1), null);
    });
    $('.modal-activities input[type=search]').on('keyup', function (e) {
        applyFilter(null, $(e.target).val());
    });
    $('#activity-picker').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal.
        var title = button.data('picker-title');
        var type = button.data('activity-type');
        var modal = $(this);
        modal.find('[href="#all"]').click();
        modal.find('.modal-title').text(title);
        modal.data('activity-type', type);
        applyFilter(null, null);
    });
});

///<reference path="../../../Assets/Lib/jQuery/typings.d.ts" />
$(function () {
    var generateWorkflowUrl = function () {
        var workflowTypeId = $('[data-workflow-type-id]').data('workflow-type-id');
        var activityId = $('[data-activity-id]').data('activity-id');
        var tokenLifeSpan = $('#token-lifespan').val();
        var generateUrl = $('[data-generate-url]').data('generate-url') + ("?workflowTypeId=" + workflowTypeId + "&activityId=" + activityId + "&tokenLifeSpan=" + tokenLifeSpan);
        var antiforgeryHeaderName = $('[data-antiforgery-header-name]').data('antiforgery-header-name');
        var antiforgeryToken = $('[data-antiforgery-token]').data('antiforgery-token');
        var headers = {};
        headers[antiforgeryHeaderName] = antiforgeryToken;
        $.post({
            url: generateUrl,
            headers: headers
        }).done(function (url) {
            $('#workflow-url-text').val(url);
        });
    };
    $('#generate-url-button').on('click', function (e) {
        generateWorkflowUrl();
    });
    if ($('#workflow-url-text').val() == '') {
        generateWorkflowUrl();
    }
});

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */ (function () {
    function WorkflowCanvas(container, workflowType) {
        var _this = this;
        this.container = container;
        this.workflowType = workflowType;
        this.minCanvasHeight = 400;
        this.getActivityElements = function () {
            return $(_this.container).find('.activity');
        };
        this.getDefaults = function () {
            return {
                Anchor: "Continuous",
                DragOptions: { cursor: 'pointer', zIndex: 2000 },
                EndpointStyles: [{ fillStyle: '#225588' }],
                Endpoints: [["Dot", { radius: 7 }], ["Blank"]],
                ConnectionOverlays: [
                    ["Arrow", { width: 12, length: 12, location: -5 }],
                ],
                ConnectorZIndex: 5
            };
        };
        this.createJsPlumbInstance = function () {
            return jsPlumb.getInstance({
                DragOptions: { cursor: 'pointer', zIndex: 2000 },
                ConnectionOverlays: [
                    ['Arrow', {
                            location: 1,
                            visible: true,
                            width: 11,
                            length: 11
                        }],
                    ['Label', {
                            location: 0.5,
                            id: 'label',
                            cssClass: 'connection-label'
                        }]
                ],
                Container: _this.container
            });
        };
        this.getEndpointColor = function (activity) {
            return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
        };
        this.getSourceEndpointOptions = function (activity, outcome) {
            // The definition of source endpoints.
            var paintColor = _this.getEndpointColor(activity);
            return {
                endpoint: 'Dot',
                anchor: 'Continuous',
                paintStyle: {
                    stroke: paintColor,
                    fill: paintColor,
                    radius: 7,
                    strokeWidth: 1
                },
                isSource: true,
                connector: ['Flowchart', { stub: [40, 60], gap: 0, cornerRadius: 5, alwaysRespectStubs: true }],
                connectorStyle: {
                    strokeWidth: 2,
                    stroke: '#999999',
                    joinstyle: 'round',
                    outlineStroke: 'white',
                    outlineWidth: 2
                },
                hoverPaintStyle: {
                    fill: '#216477',
                    stroke: '#216477'
                },
                connectorHoverStyle: {
                    strokeWidth: 3,
                    stroke: '#216477',
                    outlineWidth: 5,
                    outlineStroke: 'white'
                },
                connectorOverlays: [['Label', { location: [3, -1.5], cssClass: 'endpointSourceLabel' }]],
                dragOptions: {},
                uuid: activity.id + "-" + outcome.name,
                parameters: {
                    outcome: outcome
                }
            };
        };
        this.getActivity = function (id, activities) {
            if (activities === void 0) { activities = null; }
            if (!activities) {
                activities = this.workflowType.activities;
            }
            return $.grep(activities, function (x) { return x.id === id; })[0];
        };
        this.updateConnections = function (plumber) {
            var workflowId = _this.workflowType.id;
            // Connect activities.
            for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
                var transitionModel = _a[_i];
                var sourceEndpointUuid = transitionModel.sourceActivityId + "-" + transitionModel.sourceOutcomeName;
                var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
                var destinationElementId = "activity-" + workflowId + "-" + transitionModel.destinationActivityId;
                plumber.connect({
                    source: sourceEndpoint,
                    target: destinationElementId
                });
            }
        };
        this.updateCanvasHeight = function () {
            var $container = $(this.container);
            // Get the activity element with the highest Y coordinate.
            var $activityElements = $container.find(".activity");
            var currentElementTop = 0;
            var currentActivityHeight = 0;
            for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
                var activityElement = _a[_i];
                var $activityElement = $(activityElement);
                var top_1 = $activityElement.position().top;
                if (top_1 > currentElementTop) {
                    currentElementTop = top_1;
                    currentActivityHeight = $activityElement.height();
                }
            }
            var newCanvasHeight = currentElementTop + currentActivityHeight;
            var elementBottom = currentElementTop + currentActivityHeight;
            var stretchValue = 100;
            if (newCanvasHeight - elementBottom <= stretchValue) {
                newCanvasHeight += stretchValue;
            }
            $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
        };
    }
    return WorkflowCanvas;
}());

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
// TODO: Re-implement this using a MVVM approach.
var WorkflowEditor = /** @class */ (function (_super) {
    __extends(WorkflowEditor, _super);
    function WorkflowEditor(container, workflowType, deleteActivityPrompt, localId, loadLocalState) {
        var _this = _super.call(this, container, workflowType) || this;
        _this.container = container;
        _this.workflowType = workflowType;
        _this.deleteActivityPrompt = deleteActivityPrompt;
        _this.localId = localId;
        _this.getState = function () {
            var $allActivityElements = $(_this.container).find('.activity');
            var workflow = {
                id: _this.workflowType.id,
                activities: [],
                transitions: [],
                removedActivities: _this.workflowType.removedActivities
            };
            // Collect activities.
            for (var i = 0; i < $allActivityElements.length; i++) {
                var $activityElement = $($allActivityElements[i]);
                var activityId = $activityElement.data('activity-id');
                var activityIsStart = $activityElement.data('activity-start');
                var activityIsEvent = $activityElement.data('activity-type') === 'Event';
                var activityPosition = $activityElement.position();
                var activity = _this.getActivity(activityId);
                workflow.activities.push({
                    id: activityId,
                    isStart: activityIsStart,
                    isEvent: activityIsEvent,
                    outcomes: activity.outcomes,
                    x: activityPosition.left,
                    y: activityPosition.top
                });
            }
            // Collect connections.
            var allConnections = _this.jsPlumbInstance.getConnections();
            for (var i = 0; i < allConnections.length; i++) {
                var connection = allConnections[i];
                var sourceEndpoint = connection.endpoints[0];
                var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;
                var sourceActivityId = $(connection.source).data('activity-id');
                var destinationActivityId = $(connection.target).data('activity-id');
                workflow.transitions.push({
                    sourceActivityId: sourceActivityId,
                    destinationActivityId: destinationActivityId,
                    sourceOutcomeName: sourceOutcomeName
                });
            }
            return workflow;
        };
        _this.serialize = function () {
            var workflow = _this.getState();
            return JSON.stringify(workflow);
        };
        _this.saveLocalState = function () {
            sessionStorage[_this.localId] = _this.serialize();
        };
        _this.loadLocalState = function () {
            return JSON.parse(sessionStorage[_this.localId]);
        };
        var self = _this;
        jsPlumb.ready(function () {
            jsPlumb.importDefaults(_this.getDefaults());
            var plumber = _this.createJsPlumbInstance();
            // Listen for new connections.
            plumber.bind('connection', function (connInfo, originalEvent) {
                var connection = connInfo.connection;
                var outcome = connection.getParameters().outcome;
                var label = connection.getOverlay('label');
                label.setLabel(outcome.displayName);
            });
            var activityElements = _this.getActivityElements();
            var areEqualOutcomes = function (outcomes1, outcomes2) {
                if (outcomes1.length != outcomes2.length) {
                    return false;
                }
                for (var i = 0; i < outcomes1.length; i++) {
                    var outcome1 = outcomes1[i];
                    var outcome2 = outcomes2[i];
                    if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
                        return false;
                    }
                }
                return true;
            };
            // Suspend drawing and initialize.
            plumber.batch(function () {
                var serverworkflowType = _this.workflowType;
                var workflowId = _this.workflowType.id;
                if (loadLocalState) {
                    var localState = _this.loadLocalState();
                    if (localState) {
                        _this.workflowType = localState;
                    }
                }
                activityElements.each(function (index, activityElement) {
                    var $activityElement = $(activityElement);
                    var activityId = $activityElement.data('activity-id');
                    var isDeleted = _this.workflowType.removedActivities.indexOf(activityId) > -1;
                    if (isDeleted) {
                        $activityElement.remove();
                        return;
                    }
                    var activity = _this.getActivity(activityId);
                    var serverActivity = _this.getActivity(activityId, serverworkflowType.activities);
                    // Update the activity's visual state.
                    if (loadLocalState) {
                        if (activity == null) {
                            // This is a newly added activity not yet added to local state.
                            activity = serverActivity;
                            _this.workflowType.activities.push(activity);
                            activity.x = 50;
                            activity.y = 50;
                        }
                        else {
                            // The available outcomes might have changed when editing an activity,
                            // so we need to check for that and update the client's activity outcomes if so.
                            var sameOutcomes = areEqualOutcomes(activity.outcomes, serverActivity.outcomes);
                            if (!sameOutcomes) {
                                activity.outcomes = serverActivity.outcomes;
                            }
                            $activityElement
                                .css({ left: activity.x, top: activity.y })
                                .toggleClass('activity-start', activity.isStart)
                                .data('activity-start', activity.isStart);
                        }
                    }
                    // Make the activity draggable.
                    plumber.draggable(activityElement, {
                        grid: [10, 10],
                        containment: true,
                        start: function (args) {
                            _this.dragStart = { left: args.e.screenX, top: args.e.screenY };
                        },
                        stop: function (args) {
                            _this.hasDragged = _this.dragStart.left != args.e.screenX || _this.dragStart.top != args.e.screenY;
                            _this.updateCanvasHeight();
                        }
                    });
                    // Configure the activity as a target.
                    plumber.makeTarget(activityElement, {
                        dropOptions: { hoverClass: 'hover' },
                        anchor: 'Continuous',
                        endpoint: ['Blank', { radius: 8 }]
                    });
                    // Add source endpoints.
                    for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
                        var outcome = _a[_i];
                        var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
                        plumber.addEndpoint(activityElement, { connectorOverlays: [['Label', { label: outcome.displayName, cssClass: 'connection-label' }]] }, sourceEndpointOptions);
                    }
                });
                // Connect activities.
                _this.updateConnections(plumber);
                // Re-query the activity elements.
                activityElements = _this.getActivityElements();
                // Make all activity elements visible.
                activityElements.show();
                _this.updateCanvasHeight();
            });
            // Initialize popovers. 
            activityElements.popover({
                trigger: 'manual',
                html: true,
                content: function () {
                    var activityElement = $(this);
                    var $content = activityElement.find('.activity-commands').clone().show();
                    var startButton = $content.find('.activity-start-action');
                    var isStart = activityElement.data('activity-start') === true;
                    var activityId = activityElement.data('activity-id');
                    startButton.attr('aria-pressed', activityElement.data('activity-start'));
                    startButton.toggleClass('active', isStart);
                    $content.on('click', '.activity-start-action', function (e) {
                        e.preventDefault();
                        var button = $(e.currentTarget);
                        button.button('toggle');
                        var isStart = button.is('.active');
                        activityElement.data('activity-start', isStart);
                        activityElement.toggleClass('activity-start', isStart);
                    });
                    $content.on('click', '.activity-delete-action', function (e) {
                        e.preventDefault();
                        // TODO: The prompts are really annoying. Consider showing some sort of small message balloon somewhere to undo the action instead.
                        //if (!confirm(self.deleteActivityPrompt)) {
                        //    return;
                        //}
                        self.workflowType.removedActivities.push(activityId);
                        plumber.remove(activityElement);
                        activityElement.popover('dispose');
                    });
                    $content.on('click', '[data-persist-workflow]', function (e) {
                        self.saveLocalState();
                    });
                    return $content.get(0);
                }
            });
            $(container).on('click', '.activity', function (e) {
                if (_this.hasDragged) {
                    _this.hasDragged = false;
                    return;
                }
                // if any other popovers are visible, hide them
                if (_this.isPopoverVisible) {
                    activityElements.popover('hide');
                }
                var sender = $(e.currentTarget);
                sender.popover('show');
                // handle clicking on the popover itself.
                $('.popover').off('click').on('click', function (e2) {
                    e2.stopPropagation();
                });
                e.stopPropagation();
                _this.isPopoverVisible = true;
            });
            $(container).on('dblclick', '.activity', function (e) {
                var sender = $(e.currentTarget);
                var hasEditor = sender.data('activity-has-editor');
                if (hasEditor) {
                    _this.saveLocalState();
                    sender.find('.activity-edit-action').get(0).click();
                }
            });
            // Hide all popovers when clicking anywhere but on an activity.
            $('body').on('click', function (e) {
                activityElements.popover('hide');
                _this.isPopoverVisible = false;
            });
            // Save local changes if the event target has the 'data-persist-workflow' attribute.
            $('body').on('click', '[data-persist-workflow]', function (e) {
                _this.saveLocalState();
            });
            _this.jsPlumbInstance = plumber;
        });
        return _this;
    }
    return WorkflowEditor;
}(WorkflowCanvas));
$.fn.workflowEditor = function () {
    this.each(function (index, element) {
        var $element = $(element);
        var workflowType = $element.data('workflow-type');
        var deleteActivityPrompt = $element.data('workflow-delete-activity-prompt');
        var localId = $element.data('workflow-local-id');
        var loadLocalState = $element.data('workflow-load-local-state');
        workflowType.removedActivities = workflowType.removedActivities || [];
        $element.data('workflowEditor', new WorkflowEditor(element, workflowType, deleteActivityPrompt, localId, loadLocalState));
    });
    return this;
};
$(document).ready(function () {
    var workflowEditor = $('.workflow-canvas').workflowEditor().data('workflowEditor');
    $('#workflowEditorForm').on('submit', function (s, e) {
        var state = workflowEditor.serialize();
        $('#workflowStateInput').val(state);
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5LXBpY2tlci50cyIsIndvcmtmbG93LXVybC1nZW5lcmF0b3IudHMiLCJ3b3JrZmxvdy1jYW52YXMudHMiLCJ3b3JrZmxvdy1lZGl0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0RUFBNEU7QUFFNUUsSUFBSSxXQUFXLEdBQUcsVUFBVSxRQUFnQixFQUFFLENBQVM7SUFDbkQsSUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzFELFFBQVEsR0FBRyxRQUFRLElBQUksQ0FBQyxDQUFDLDhDQUE4QyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRyxDQUFDLEdBQUcsQ0FBQyxJQUFZLENBQUMsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBRWpFLElBQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBRTFDLDJFQUEyRTtJQUMzRSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDaEIsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUMvQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVWLElBQUksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7UUFDZCx5REFBeUQ7UUFDekQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxFQUFFO1lBQ2hCLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUcs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QUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJvcmNoYXJkLndvcmtmbG93cy1lZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQHR5cGVzL2pxdWVyeS9pbmRleC5kLnRzXCIgLz5cclxuXHJcbnZhciBhcHBseUZpbHRlciA9IGZ1bmN0aW9uIChjYXRlZ29yeTogc3RyaW5nLCBxOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHR5cGUgPSAkKCcubW9kYWwtYWN0aXZpdGllcycpLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKTtcclxuICAgIGNhdGVnb3J5ID0gY2F0ZWdvcnkgfHwgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzIC5uYXYtbGluay5hY3RpdmUnKS5hdHRyKCdocmVmJykuc3Vic3RyKDEpO1xyXG4gICAgcSA9IHEgfHwgPHN0cmluZz4kKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS52YWwoKTtcclxuXHJcbiAgICBjb25zdCAkY2FyZHMgPSAkKCcuYWN0aXZpdHkuY2FyZCcpLnNob3coKTtcclxuXHJcbiAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9lcyB0eXBlIGRvZXNuJ3QgbWF0Y2ggdGhlIGNvbmZpZ3VyZWQgYWN0aXZpdHkgdHlwZS5cclxuICAgICRjYXJkcy5maWx0ZXIoKGksIGVsKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSAhPSB0eXBlO1xyXG4gICAgfSkuaGlkZSgpO1xyXG5cclxuICAgIGlmIChxLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSB0aXRsZSBkb2Vzbid0IG1hdGNoIHRoZSBxdWVyeS5cclxuICAgICAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZmluZCgnLmNhcmQtdGl0bGUnKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHEudG9Mb3dlckNhc2UoKSkgPCAwICYmIHEgJiYgcS5sZW5ndGggPiAwO1xyXG4gICAgICAgIH0pLmhpZGUoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob3NlIGNhdGVnb3J5IGRvZXNuJ3QgbWF0Y2ggdGhlIHNlbGVjdGVkIG9uZS5cclxuICAgICAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YSgnY2F0ZWdvcnknKS50b0xvd2VyQ2FzZSgpICE9IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkgJiYgY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSAhPSAnYWxsJztcclxuICAgICAgICB9KS5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2hvdyBvciBoaWRlIGNhdGVnb3JpZXMgYmFzZWQgb24gd2hldGhlciB0aGVyZSBhcmUgYW55IGF2YWlsYWJsZSBhY3Rpdml0aWVzLlxyXG4gICAgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzIFtkYXRhLWNhdGVnb3J5XScpLmVhY2goKGksIGVsKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlMaXN0SXRlbSA9ICQoZWwpO1xyXG4gICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gY2F0ZWdvcnlMaXN0SXRlbS5kYXRhKCdjYXRlZ29yeScpO1xyXG5cclxuICAgICAgICAvLyBDb3VudCBudW1iZXIgb2YgYWN0aXZpdGllcyB3aXRoaW4gdGhpcyBjYXRlZ29yeSBhbmQgZm9yIHRoZSBzcGVjaWZpZWQgYWN0aXZpdHkgdHlwZSAoRXZlbnQgb3IgVGFzaykuXHJcbiAgICAgICAgY29uc3QgYWN0aXZpdHlDb3VudCA9ICQoYC5hY3Rpdml0eS5jYXJkW2RhdGEtY2F0ZWdvcnk9JyR7Y2F0ZWdvcnl9J11bZGF0YS1hY3Rpdml0eS10eXBlPScke3R5cGV9J11gKS5sZW5ndGg7XHJcbiAgICAgICAgYWN0aXZpdHlDb3VudCA9PSAwID8gY2F0ZWdvcnlMaXN0SXRlbS5oaWRlKCkgOiBjYXRlZ29yeUxpc3RJdGVtLnNob3coKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuJCgoKSA9PiB7XHJcbiAgICAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMnKS5vbignY2xpY2snLCAnLm5hdi1saW5rJywgZSA9PiB7XHJcbiAgICAgICAgYXBwbHlGaWx0ZXIoJChlLnRhcmdldCkuYXR0cignaHJlZicpLnN1YnN0cigxKSwgbnVsbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS5vbigna2V5dXAnLCBlID0+IHtcclxuICAgICAgICBhcHBseUZpbHRlcihudWxsLCA8c3RyaW5nPiQoZS50YXJnZXQpLnZhbCgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNhY3Rpdml0eS1waWNrZXInKS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBidXR0b24gPSAkKGV2ZW50LnJlbGF0ZWRUYXJnZXQpIC8vIEJ1dHRvbiB0aGF0IHRyaWdnZXJlZCB0aGUgbW9kYWwuXHJcbiAgICAgICAgdmFyIHRpdGxlID0gYnV0dG9uLmRhdGEoJ3BpY2tlci10aXRsZScpO1xyXG4gICAgICAgIHZhciB0eXBlID0gYnV0dG9uLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKTtcclxuICAgICAgICB2YXIgbW9kYWwgPSAkKHRoaXMpO1xyXG4gICAgICAgIG1vZGFsLmZpbmQoJ1tocmVmPVwiI2FsbFwiXScpLmNsaWNrKCk7XHJcbiAgICAgICAgbW9kYWwuZmluZCgnLm1vZGFsLXRpdGxlJykudGV4dCh0aXRsZSk7XHJcbiAgICAgICAgbW9kYWwuZGF0YSgnYWN0aXZpdHktdHlwZScsIHR5cGUpO1xyXG4gICAgICAgIGFwcGx5RmlsdGVyKG51bGwsIG51bGwpO1xyXG4gICAgfSlcclxufSk7IiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vQXNzZXRzL0xpYi9qUXVlcnkvdHlwaW5ncy5kLnRzXCIgLz5cclxuXHJcbiQoKCkgPT4ge1xyXG4gICAgY29uc3QgZ2VuZXJhdGVXb3JrZmxvd1VybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCB3b3JrZmxvd1R5cGVJZDogc3RyaW5nID0gJCgnW2RhdGEtd29ya2Zsb3ctdHlwZS1pZF0nKS5kYXRhKCd3b3JrZmxvdy10eXBlLWlkJyk7XHJcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZDogc3RyaW5nID0gJCgnW2RhdGEtYWN0aXZpdHktaWRdJykuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICB2YXIgdG9rZW5MaWZlU3BhbiA9ICQoJyN0b2tlbi1saWZlc3BhbicpLnZhbCgpO1xyXG4gICAgICAgIGNvbnN0IGdlbmVyYXRlVXJsOiBzdHJpbmcgPSAkKCdbZGF0YS1nZW5lcmF0ZS11cmxdJykuZGF0YSgnZ2VuZXJhdGUtdXJsJykgKyBgP3dvcmtmbG93VHlwZUlkPSR7d29ya2Zsb3dUeXBlSWR9JmFjdGl2aXR5SWQ9JHthY3Rpdml0eUlkfSZ0b2tlbkxpZmVTcGFuPSR7dG9rZW5MaWZlU3Bhbn1gO1xyXG4gICAgICAgIGNvbnN0IGFudGlmb3JnZXJ5SGVhZGVyTmFtZTogc3RyaW5nID0gJCgnW2RhdGEtYW50aWZvcmdlcnktaGVhZGVyLW5hbWVdJykuZGF0YSgnYW50aWZvcmdlcnktaGVhZGVyLW5hbWUnKTtcclxuICAgICAgICBjb25zdCBhbnRpZm9yZ2VyeVRva2VuOiBzdHJpbmcgPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS10b2tlbl0nKS5kYXRhKCdhbnRpZm9yZ2VyeS10b2tlbicpO1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnM6IGFueSA9IHt9O1xyXG5cclxuICAgICAgICBoZWFkZXJzW2FudGlmb3JnZXJ5SGVhZGVyTmFtZV0gPSBhbnRpZm9yZ2VyeVRva2VuO1xyXG5cclxuICAgICAgICAkLnBvc3Qoe1xyXG4gICAgICAgICAgICB1cmw6IGdlbmVyYXRlVXJsLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXHJcbiAgICAgICAgfSkuZG9uZSh1cmwgPT4ge1xyXG4gICAgICAgICAgICAkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwodXJsKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgJCgnI2dlbmVyYXRlLXVybC1idXR0b24nKS5vbignY2xpY2snLCBlID0+IHtcclxuICAgICAgICBnZW5lcmF0ZVdvcmtmbG93VXJsKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoJCgnI3dvcmtmbG93LXVybC10ZXh0JykudmFsKCkgPT0gJycpIHtcclxuICAgICAgICBnZW5lcmF0ZVdvcmtmbG93VXJsKCk7XHJcbiAgICB9XHJcbn0pOyIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxyXG5cclxuYWJzdHJhY3QgY2xhc3MgV29ya2Zsb3dDYW52YXMge1xyXG4gICAgcHJpdmF0ZSBtaW5DYW52YXNIZWlnaHQ6IG51bWJlciA9IDQwMDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcHJvdGVjdGVkIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSkge1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRBY3Rpdml0eUVsZW1lbnRzID0gKCk6IEpRdWVyeSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICQodGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXREZWZhdWx0cyA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBBbmNob3I6IFwiQ29udGludW91c1wiLFxyXG4gICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXHJcbiAgICAgICAgICAgIEVuZHBvaW50U3R5bGVzOiBbeyBmaWxsU3R5bGU6ICcjMjI1NTg4JyB9XSxcclxuICAgICAgICAgICAgRW5kcG9pbnRzOiBbW1wiRG90XCIsIHsgcmFkaXVzOiA3IH1dLCBbXCJCbGFua1wiXV0sXHJcbiAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgW1wiQXJyb3dcIiwgeyB3aWR0aDogMTIsIGxlbmd0aDogMTIsIGxvY2F0aW9uOiAtNSB9XSxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgQ29ubmVjdG9yWkluZGV4OiA1XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgY3JlYXRlSnNQbHVtYkluc3RhbmNlID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBqc1BsdW1iLmdldEluc3RhbmNlKHtcclxuICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxyXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcclxuICAgICAgICAgICAgICAgIFsnQXJyb3cnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEsXHJcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICBbJ0xhYmVsJywge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdsYWJlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJ1xyXG4gICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgQ29udGFpbmVyOiB0aGlzLmNvbnRhaW5lclxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RW5kcG9pbnRDb2xvciA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgfHwgYWN0aXZpdHkuaXNTdGFydCA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5LCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSk6IEVuZHBvaW50T3B0aW9ucyA9PiB7XHJcbiAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICBjb25zdCBwYWludENvbG9yID0gdGhpcy5nZXRFbmRwb2ludENvbG9yKGFjdGl2aXR5KTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlbmRwb2ludDogJ0RvdCcsXHJcbiAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxyXG4gICAgICAgICAgICBwYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2U6IHBhaW50Q29sb3IsXHJcbiAgICAgICAgICAgICAgICBmaWxsOiBwYWludENvbG9yLFxyXG4gICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbm5lY3RvcjogWydGbG93Y2hhcnQnLCB7IHN0dWI6IFs0MCwgNjBdLCBnYXA6IDAsIGNvcm5lclJhZGl1czogNSwgYWx3YXlzUmVzcGVjdFN0dWJzOiB0cnVlIH1dLFxyXG4gICAgICAgICAgICBjb25uZWN0b3JTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjOTk5OTk5JyxcclxuICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogJ3JvdW5kJyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBmaWxsOiAnIzIxNjQ3NycsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25uZWN0b3JIb3ZlclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiA1LFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxvY2F0aW9uOiBbMywgLTEuNV0sIGNzc0NsYXNzOiAnZW5kcG9pbnRTb3VyY2VMYWJlbCcgfV1dLFxyXG4gICAgICAgICAgICBkcmFnT3B0aW9uczoge30sXHJcbiAgICAgICAgICAgIHV1aWQ6IGAke2FjdGl2aXR5LmlkfS0ke291dGNvbWUubmFtZX1gLFxyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBvdXRjb21lOiBvdXRjb21lXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHkgPSBmdW5jdGlvbiAoaWQ6IHN0cmluZywgYWN0aXZpdGllczogQXJyYXk8V29ya2Zsb3dzLkFjdGl2aXR5PiA9IG51bGwpOiBXb3JrZmxvd3MuQWN0aXZpdHkge1xyXG4gICAgICAgIGlmICghYWN0aXZpdGllcykge1xyXG4gICAgICAgICAgICBhY3Rpdml0aWVzID0gdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICQuZ3JlcChhY3Rpdml0aWVzLCAoeDogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB4LmlkID09PSBpZClbMF07XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZUNvbm5lY3Rpb25zID0gKHBsdW1iZXI6IGpzUGx1bWJJbnN0YW5jZSkgPT4ge1xyXG4gICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcclxuXHJcbiAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxyXG4gICAgICAgIGZvciAobGV0IHRyYW5zaXRpb25Nb2RlbCBvZiB0aGlzLndvcmtmbG93VHlwZS50cmFuc2l0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludFV1aWQ6IHN0cmluZyA9IGAke3RyYW5zaXRpb25Nb2RlbC5zb3VyY2VBY3Rpdml0eUlkfS0ke3RyYW5zaXRpb25Nb2RlbC5zb3VyY2VPdXRjb21lTmFtZX1gO1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludDogRW5kcG9pbnQgPSBwbHVtYmVyLmdldEVuZHBvaW50KHNvdXJjZUVuZHBvaW50VXVpZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uRWxlbWVudElkOiBzdHJpbmcgPSBgYWN0aXZpdHktJHt3b3JrZmxvd0lkfS0ke3RyYW5zaXRpb25Nb2RlbC5kZXN0aW5hdGlvbkFjdGl2aXR5SWR9YDtcclxuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuY29ubmVjdCh7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZUVuZHBvaW50LFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCAkY29udGFpbmVyID0gJCh0aGlzLmNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIC8vIEdldCB0aGUgYWN0aXZpdHkgZWxlbWVudCB3aXRoIHRoZSBoaWdoZXN0IFkgY29vcmRpbmF0ZS5cclxuICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50cyA9ICRjb250YWluZXIuZmluZChcIi5hY3Rpdml0eVwiKTtcclxuICAgICAgICBsZXQgY3VycmVudEVsZW1lbnRUb3AgPSAwO1xyXG4gICAgICAgIGxldCBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAwO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBhY3Rpdml0eUVsZW1lbnQgb2YgJGFjdGl2aXR5RWxlbWVudHMudG9BcnJheSgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvcCA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKS50b3A7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9wID4gY3VycmVudEVsZW1lbnRUb3ApIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50VG9wID0gdG9wO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gJGFjdGl2aXR5RWxlbWVudC5oZWlnaHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG5ld0NhbnZhc0hlaWdodCA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRCb3R0b20gPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcclxuICAgICAgICBjb25zdCBzdHJldGNoVmFsdWUgPSAxMDA7XHJcblxyXG4gICAgICAgIGlmIChuZXdDYW52YXNIZWlnaHQgLSBlbGVtZW50Qm90dG9tIDw9IHN0cmV0Y2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBuZXdDYW52YXNIZWlnaHQgKz0gc3RyZXRjaFZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGNvbnRhaW5lci5oZWlnaHQoTWF0aC5tYXgodGhpcy5taW5DYW52YXNIZWlnaHQsIG5ld0NhbnZhc0hlaWdodCkpO1xyXG4gICAgfTtcclxufSIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxyXG5cclxuLy8gVE9ETzogUmUtaW1wbGVtZW50IHRoaXMgdXNpbmcgYSBNVlZNIGFwcHJvYWNoLlxyXG5jbGFzcyBXb3JrZmxvd0VkaXRvciBleHRlbmRzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUganNQbHVtYkluc3RhbmNlOiBqc1BsdW1iSW5zdGFuY2U7XHJcbiAgICBwcml2YXRlIGlzUG9wb3ZlclZpc2libGU6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGhhc0RyYWdnZWQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGRyYWdTdGFydDogSlF1ZXJ5LkNvb3JkaW5hdGVzO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlLCBwcml2YXRlIGRlbGV0ZUFjdGl2aXR5UHJvbXB0OiBzdHJpbmcsIHByaXZhdGUgbG9jYWxJZDogc3RyaW5nLCBsb2FkTG9jYWxTdGF0ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHN1cGVyKGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKTtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAganNQbHVtYi5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHModGhpcy5nZXREZWZhdWx0cygpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBsdW1iZXIgPSB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbjogQ29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWw6IGFueSA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxldCBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczE6IFdvcmtmbG93cy5PdXRjb21lW10sIG91dGNvbWVzMjogV29ya2Zsb3dzLk91dGNvbWVbXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUxID0gb3V0Y29tZXMxW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlcndvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHRoaXMud29ya2Zsb3dUeXBlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQ6IG51bWJlciA9IHRoaXMud29ya2Zsb3dUeXBlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsU3RhdGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSB0aGlzLmxvYWRMb2NhbFN0YXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dUeXBlID0gbG9jYWxTdGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKChpbmRleCwgYWN0aXZpdHlFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzRGVsZXRlZCA9IHRoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLmluZGV4T2YoYWN0aXZpdHlJZCkgPiAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZpdHlFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZpdHkgPSB0aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkLCBzZXJ2ZXJ3b3JrZmxvd1R5cGUuYWN0aXZpdGllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgYWN0aXZpdHkncyB2aXN1YWwgc3RhdGUuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpdml0eSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbmV3bHkgYWRkZWQgYWN0aXZpdHkgbm90IHlldCBhZGRlZCB0byBsb2NhbCBzdGF0ZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5ID0gc2VydmVyQWN0aXZpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzLnB1c2goYWN0aXZpdHkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnggPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnkgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhdmFpbGFibGUgb3V0Y29tZXMgbWlnaHQgaGF2ZSBjaGFuZ2VkIHdoZW4gZWRpdGluZyBhbiBhY3Rpdml0eSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHRoYXQgYW5kIHVwZGF0ZSB0aGUgY2xpZW50J3MgYWN0aXZpdHkgb3V0Y29tZXMgaWYgc28uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1lT3V0Y29tZXMgPSBhcmVFcXVhbE91dGNvbWVzKGFjdGl2aXR5Lm91dGNvbWVzLCBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzYW1lT3V0Y29tZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5vdXRjb21lcyA9IHNlcnZlckFjdGl2aXR5Lm91dGNvbWVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpdml0eUVsZW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3NzKHsgbGVmdDogYWN0aXZpdHkueCwgdG9wOiBhY3Rpdml0eS55IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGFjdGl2aXR5LmlzU3RhcnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGFjdGl2aXR5IGRyYWdnYWJsZS5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmRyYWdnYWJsZShhY3Rpdml0eUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogWzEwLCAxMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogKGFyZ3M6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnQgPSB7IGxlZnQ6IGFyZ3MuZS5zY3JlZW5YLCB0b3A6IGFyZ3MuZS5zY3JlZW5ZIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3A6IChhcmdzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRHJhZ2dlZCA9IHRoaXMuZHJhZ1N0YXJ0LmxlZnQgIT0gYXJncy5lLnNjcmVlblggfHwgdGhpcy5kcmFnU3RhcnQudG9wICE9IGFyZ3MuZS5zY3JlZW5ZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIGFjdGl2aXR5IGFzIGEgdGFyZ2V0LlxyXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogJ2hvdmVyJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBvdXRjb21lIG9mIGFjdGl2aXR5Lm91dGNvbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IHRoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zKGFjdGl2aXR5LCBvdXRjb21lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMgPSB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNYWtlIGFsbCBhY3Rpdml0eSBlbGVtZW50cyB2aXNpYmxlLlxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHBvcG92ZXJzLiBcclxuICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5wb3BvdmVyKHtcclxuICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdtYW51YWwnLFxyXG4gICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUVsZW1lbnQgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRjb250ZW50OiBKUXVlcnk8RWxlbWVudD4gPSBhY3Rpdml0eUVsZW1lbnQuZmluZCgnLmFjdGl2aXR5LWNvbW1hbmRzJykuY2xvbmUoKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSAkY29udGVudC5maW5kKCcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTdGFydCA9IGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpID09PSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SWQ6IG51bWJlciA9IGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi5hdHRyKCdhcmlhLXByZXNzZWQnLCBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdXR0b24udG9nZ2xlQ2xhc3MoJ2FjdGl2ZScsIGlzU3RhcnQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b24oJ3RvZ2dsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTdGFydCA9IGJ1dHRvbi5pcygnLmFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnLCBpc1N0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LWRlbGV0ZS1hY3Rpb24nLCBlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhlIHByb21wdHMgYXJlIHJlYWxseSBhbm5veWluZy4gQ29uc2lkZXIgc2hvd2luZyBzb21lIHNvcnQgb2Ygc21hbGwgbWVzc2FnZSBiYWxsb29uIHNvbWV3aGVyZSB0byB1bmRvIHRoZSBhY3Rpb24gaW5zdGVhZC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoIWNvbmZpcm0oc2VsZi5kZWxldGVBY3Rpdml0eVByb21wdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLnB1c2goYWN0aXZpdHlJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIucmVtb3ZlKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKCdkaXNwb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmVMb2NhbFN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudC5nZXQoMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChjb250YWluZXIpLm9uKCdjbGljaycsICcuYWN0aXZpdHknLCBlID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNEcmFnZ2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNEcmFnZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGFueSBvdGhlciBwb3BvdmVycyBhcmUgdmlzaWJsZSwgaGlkZSB0aGVtXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1BvcG92ZXJWaXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5wb3BvdmVyKCdoaWRlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgc2VuZGVyLnBvcG92ZXIoJ3Nob3cnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgY2xpY2tpbmcgb24gdGhlIHBvcG92ZXIgaXRzZWxmLlxyXG4gICAgICAgICAgICAgICAgJCgnLnBvcG92ZXInKS5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgZTIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUyLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGNvbnRhaW5lcikub24oJ2RibGNsaWNrJywgJy5hY3Rpdml0eScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzRWRpdG9yID0gc2VuZGVyLmRhdGEoJ2FjdGl2aXR5LWhhcy1lZGl0b3InKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzRWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlTG9jYWxTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbmRlci5maW5kKCcuYWN0aXZpdHktZWRpdC1hY3Rpb24nKS5nZXQoMCkuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBIaWRlIGFsbCBwb3BvdmVycyB3aGVuIGNsaWNraW5nIGFueXdoZXJlIGJ1dCBvbiBhbiBhY3Rpdml0eS5cclxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5wb3BvdmVyKCdoaWRlJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzUG9wb3ZlclZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBTYXZlIGxvY2FsIGNoYW5nZXMgaWYgdGhlIGV2ZW50IHRhcmdldCBoYXMgdGhlICdkYXRhLXBlcnNpc3Qtd29ya2Zsb3cnIGF0dHJpYnV0ZS5cclxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlTG9jYWxTdGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFN0YXRlID0gKCk6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPT4ge1xyXG4gICAgICAgIGNvbnN0ICRhbGxBY3Rpdml0eUVsZW1lbnRzID0gJCh0aGlzLmNvbnRhaW5lcikuZmluZCgnLmFjdGl2aXR5Jyk7XHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3c6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSB7XHJcbiAgICAgICAgICAgIGlkOiB0aGlzLndvcmtmbG93VHlwZS5pZCxcclxuICAgICAgICAgICAgYWN0aXZpdGllczogW10sXHJcbiAgICAgICAgICAgIHRyYW5zaXRpb25zOiBbXSxcclxuICAgICAgICAgICAgcmVtb3ZlZEFjdGl2aXRpZXM6IHRoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQ29sbGVjdCBhY3Rpdml0aWVzLlxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgJGFsbEFjdGl2aXR5RWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudDogSlF1ZXJ5ID0gJCgkYWxsQWN0aXZpdHlFbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SWQ6IHN0cmluZyA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJc1N0YXJ0OiBib29sZWFuID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpO1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlzRXZlbnQ6IGJvb2xlYW4gPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSA9PT0gJ0V2ZW50JztcclxuICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlQb3NpdGlvbjogSlF1ZXJ5LkNvb3JkaW5hdGVzID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcclxuXHJcbiAgICAgICAgICAgIHdvcmtmbG93LmFjdGl2aXRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcclxuICAgICAgICAgICAgICAgIGlzU3RhcnQ6IGFjdGl2aXR5SXNTdGFydCxcclxuICAgICAgICAgICAgICAgIGlzRXZlbnQ6IGFjdGl2aXR5SXNFdmVudCxcclxuICAgICAgICAgICAgICAgIG91dGNvbWVzOiBhY3Rpdml0eS5vdXRjb21lcyxcclxuICAgICAgICAgICAgICAgIHg6IGFjdGl2aXR5UG9zaXRpb24ubGVmdCxcclxuICAgICAgICAgICAgICAgIHk6IGFjdGl2aXR5UG9zaXRpb24udG9wXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29sbGVjdCBjb25uZWN0aW9ucy5cclxuICAgICAgICBjb25zdCBhbGxDb25uZWN0aW9ucyA9IHRoaXMuanNQbHVtYkluc3RhbmNlLmdldENvbm5lY3Rpb25zKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsQ29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBhbGxDb25uZWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50OiBFbmRwb2ludCA9IGNvbm5lY3Rpb24uZW5kcG9pbnRzWzBdO1xyXG4gICAgICAgICAgICB2YXIgc291cmNlT3V0Y29tZU5hbWUgPSBzb3VyY2VFbmRwb2ludC5nZXRQYXJhbWV0ZXJzKCkub3V0Y29tZS5uYW1lO1xyXG4gICAgICAgICAgICB2YXIgc291cmNlQWN0aXZpdHlJZDogc3RyaW5nID0gJChjb25uZWN0aW9uLnNvdXJjZSkuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uQWN0aXZpdHlJZDogc3RyaW5nID0gJChjb25uZWN0aW9uLnRhcmdldCkuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuXHJcbiAgICAgICAgICAgIHdvcmtmbG93LnRyYW5zaXRpb25zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgc291cmNlQWN0aXZpdHlJZDogc291cmNlQWN0aXZpdHlJZCxcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQWN0aXZpdHlJZDogZGVzdGluYXRpb25BY3Rpdml0eUlkLFxyXG4gICAgICAgICAgICAgICAgc291cmNlT3V0Y29tZU5hbWU6IHNvdXJjZU91dGNvbWVOYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHdvcmtmbG93O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXJpYWxpemUgPSAoKTogc3RyaW5nID0+IHtcclxuICAgICAgICBjb25zdCB3b3JrZmxvdzogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHRoaXMuZ2V0U3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkod29ya2Zsb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2F2ZUxvY2FsU3RhdGUgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2VbdGhpcy5sb2NhbElkXSA9IHRoaXMuc2VyaWFsaXplKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkTG9jYWxTdGF0ZSA9ICgpOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0+IHtcclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZVt0aGlzLmxvY2FsSWRdKTtcclxuICAgIH1cclxufVxyXG5cclxuJC5mbi53b3JrZmxvd0VkaXRvciA9IGZ1bmN0aW9uICh0aGlzOiBKUXVlcnkpOiBKUXVlcnkge1xyXG4gICAgdGhpcy5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LXR5cGUnKTtcclxuICAgICAgICB2YXIgZGVsZXRlQWN0aXZpdHlQcm9tcHQ6IHN0cmluZyA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWRlbGV0ZS1hY3Rpdml0eS1wcm9tcHQnKTtcclxuICAgICAgICB2YXIgbG9jYWxJZDogc3RyaW5nID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctbG9jYWwtaWQnKTtcclxuICAgICAgICB2YXIgbG9hZExvY2FsU3RhdGU6IGJvb2xlYW4gPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2FkLWxvY2FsLXN0YXRlJyk7XHJcblxyXG4gICAgICAgIHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyA9IHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyB8fCBbXTtcclxuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd0VkaXRvcicsIG5ldyBXb3JrZmxvd0VkaXRvcihlbGVtZW50LCB3b3JrZmxvd1R5cGUsIGRlbGV0ZUFjdGl2aXR5UHJvbXB0LCBsb2NhbElkLCBsb2FkTG9jYWxTdGF0ZSkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCB3b3JrZmxvd0VkaXRvcjogV29ya2Zsb3dFZGl0b3IgPSAkKCcud29ya2Zsb3ctY2FudmFzJykud29ya2Zsb3dFZGl0b3IoKS5kYXRhKCd3b3JrZmxvd0VkaXRvcicpO1xyXG5cclxuICAgICQoJyN3b3JrZmxvd0VkaXRvckZvcm0nKS5vbignc3VibWl0JywgKHMsIGUpID0+IHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHdvcmtmbG93RWRpdG9yLnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgICQoJyN3b3JrZmxvd1N0YXRlSW5wdXQnKS52YWwoc3RhdGUpO1xyXG4gICAgfSk7XHJcbn0pOyJdfQ==
